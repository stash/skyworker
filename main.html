<!DOCTYPE html>
<html>
<head>
  <title>Status - SkyWorker</title>
  <script type="application/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.0/jquery.js"></script>
  <script type="application/javascript" src="/socket.io/socket.io.js"></script>
  <style type="text/css">
    .client {
      position: absolute;
      font-size: 24px;
      height: 32px;
      width: 256px;
      background: #888888;
      border: 1px solid black;
      font-family: Inconsolata,monospace;
      text-align: center;
      float: clear;
    }
  </style>
</head>
<body>

  <p>Rank:</p>

  <div id="leaderboard">
  </div>

<script type="application/javascript">

var ordering = [];
var incr = 40;
function redraw() {
  var $parent = $('#leaderboard');
  var offset = $parent.offset();
  var curY = 0;
  ordering.forEach(function(cli) {
    var $div = $('#client-'+cli.clientNum);

    if (!$div.length) {
      $div = $('<div id="client-'+cli.clientNum+'" class="client">'+cli.name+'</client>');
      $parent.append($div);
    } else {
      $div.text(cli.name);
    }

    if (cli.hidden) {
      $div.fadeOut('fast',function() { $div.remove() });
    } else {
      $div.animate({ top: offset.top + curY }, 333, 'swing');
      curY += incr;
    }
  });
}

window.$ = jQuery;
$(function() {

  var socket = io.connect('http://' + window.location.host);
  socket.on('updateDisplay', function(msg) {
    console.log('got', msg);
  });

  socket.on('load', function(msg) {
    socket.emit('ready',{role:'main'});
  });

  socket.on('updateDisplay', function(msg) {
    ordering = msg.order;
    redraw();
  });
});
</script>
</body>
</html>
